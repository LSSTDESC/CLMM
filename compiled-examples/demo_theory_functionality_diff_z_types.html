<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Model WL Profiles (different redshift inputs) &mdash; CLMM 1.10.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=1d24b1d9"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Model WL Profiles (Object Oriented)" href="demo_theory_functionality_oo.html" />
    <link rel="prev" title="Example 5: Using a real datasets (DES)" href="Example5_Fit_Halo_mass_to_DES_data.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            CLMM
          </a>
              <div class="version">
                1.10.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../source/overview.html">Rapid overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source/citing.html">Using and citing CLMM</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Usage Demos</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="demo_mock_cluster.html">Generate mock data for a cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="demo_dataops_functionality.html">Measure WL Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="demo_theory_functionality.html">Model WL Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="demo_mock_ensemble.html">Generate mock data for a cluster ensemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_and_model_demo_DC2.html">Using the cosmoDC2 catalog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Mass Fitting Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Example1_Fit_Halo_Mass_to_Shear_Catalog.html">Example 1: Ideal data</a></li>
<li class="toctree-l1"><a class="reference internal" href="Example1_Fit_shear_profile_with_miscentering.html">Example 1b: Impact of miscentering</a></li>
<li class="toctree-l1"><a class="reference internal" href="Example2_Fit_Halo_Mass_to_Shear_Catalog.html">Example 2: Realistic data and wrong model</a></li>
<li class="toctree-l1"><a class="reference internal" href="Example3_Fit_Halo_Mass_to_Shear_Catalog.html">Example 3: Account for the n(z) of sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="Example4_Fit_Halo_mass_to_HSC_data.html">Example 4: Using a real dataset (HSC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Example5_Fit_Halo_mass_to_DES_data.html">Example 5: Using a real datasets (DES)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Model WL Profiles (different redshift inputs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="demo_theory_functionality_oo.html">Model WL Profiles (Object Oriented)</a></li>
<li class="toctree-l1"><a class="reference internal" href="demo_boost_factors.html">Boost factors</a></li>
<li class="toctree-l1"><a class="reference internal" href="demo_compute_deltasigma_weights.html">Weak lensing weights</a></li>
<li class="toctree-l1"><a class="reference internal" href="demo_mass_conversion.html">Mass conversion between different mass definitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="demo_mock_ensemble_realistic.html">Generate “realistic” mock data for a cluster ensemble</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/clmm.clusterensemble.html">clmm.clusterensemble module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/clmm.constants.html">clmm.constants module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/clmm.cosmology.html">clmm.cosmology package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.cosmology.ccl.html">clmm.cosmology.ccl module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.cosmology.cluster_toolkit.html">clmm.cosmology.cluster_toolkit module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.cosmology.numcosmo.html">clmm.cosmology.numcosmo module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.cosmology.parent_class.html">clmm.cosmology.parent_class module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/clmm.dataops.html">clmm.dataops package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/clmm.galaxycluster.html">clmm.galaxycluster module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/clmm.gcdata.html">clmm.gcdata module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/clmm.redshift.html">clmm.redshift package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.redshift.distributions.html">clmm.redshift.distributions module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.redshift.tools.html">clmm.redshift.tools module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/clmm.theory.html">clmm.theory package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.theory.ccl.html">clmm.theory.ccl module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.theory.cluster_toolkit.html">clmm.theory.cluster_toolkit module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.theory.func_layer.html">clmm.theory.func_layer module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.theory.generic.html">clmm.theory.generic module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.theory.numcosmo.html">clmm.theory.numcosmo module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.theory.parent_class.html">clmm.theory.parent_class module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/clmm.plotting.html">clmm.plotting package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/clmm.utils.html">clmm.utils package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.utils.beta_lens.html">clmm.utils.beta_lens module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.utils.boost.html">clmm.utils.boost module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.utils.ellipticity.html">clmm.utils.ellipticity module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.utils.statistic.html">clmm.utils.statistic module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.utils.units.html">clmm.utils.units module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.utils.validation.html">clmm.utils.validation module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/clmm.support.html">clmm.support package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.support.mock_data.html">clmm.support.mock_data module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.support.sampler.html">clmm.support.sampler module</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CLMM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Model WL Profiles (different redshift inputs)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/compiled-examples/demo_theory_functionality_diff_z_types.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="model-wl-profiles-different-redshift-inputs">
<h1>Model WL Profiles (different redshift inputs)<a class="headerlink" href="#model-wl-profiles-different-redshift-inputs" title="Link to this heading"></a></h1>
<section id="model-profiles-using-different-type-of-source-redshift-information-as-input">
<h2>Model profiles using different type of source redshift information as input<a class="headerlink" href="#model-profiles-using-different-type-of-source-redshift-information-as-input" title="Link to this heading"></a></h2>
<p>In this example we model lensing profiles by giving as input either : -
discrete source redshifts, - a redshift distribution function, - the
value of the mean beta parameters :
<span class="math notranslate nohighlight">\(\langle \beta_s \rangle = \left\langle \frac{D_{LS}}{D_S}\frac{D_\infty}{D_{L,\infty}}\right\rangle\)</span>
,
<span class="math notranslate nohighlight">\(\langle \beta_s^2 \rangle = \left\langle \left(\frac{D_{LS}}{D_S}\frac{D_\infty}{D_{L,\infty}}\right)^2 \right\rangle\)</span></p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="c1">## Uncomment the following line if you want to use a specific modeling backend among &#39;ct&#39; (cluster-toolkit), &#39;ccl&#39; (CCL) or &#39;nc&#39; (Numcosmo). Default is &#39;ccl&#39;</span>
<span class="c1"># os.environ[&#39;CLMM_MODELING_BACKEND&#39;] = &#39;nc&#39;</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">clmm</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">Math</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib</span>

<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;font.size&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>
</pre></div>
</div>
<p>Make sure we know which version we’re using</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clmm</span><span class="o">.</span><span class="n">__version__</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;1.10.0&#39;</span>
</pre></div>
</div>
</section>
<section id="import-mock-data-module-and-setup-the-configuration">
<h2>Import mock data module and setup the configuration<a class="headerlink" href="#import-mock-data-module-and-setup-the-configuration" title="Link to this heading"></a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">clmm.support</span> <span class="kn">import</span> <span class="n">mock_data</span> <span class="k">as</span> <span class="n">mock</span>
<span class="kn">from</span> <span class="nn">clmm</span> <span class="kn">import</span> <span class="n">Cosmology</span>
<span class="kn">from</span> <span class="nn">clmm.redshift.distributions</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<p>Mock data generation requires a defined cosmology</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mock_cosmo</span> <span class="o">=</span> <span class="n">Cosmology</span><span class="p">(</span><span class="n">H0</span><span class="o">=</span><span class="mf">70.0</span><span class="p">,</span> <span class="n">Omega_dm0</span><span class="o">=</span><span class="mf">0.27</span> <span class="o">-</span> <span class="mf">0.045</span><span class="p">,</span> <span class="n">Omega_b0</span><span class="o">=</span><span class="mf">0.045</span><span class="p">,</span> <span class="n">Omega_k0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
</pre></div>
</div>
<p>Mock data generation requires some cluster information</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cosmo</span> <span class="o">=</span> <span class="n">mock_cosmo</span>

<span class="c1"># cluster properties from https://arxiv.org/pdf/1611.03866.pdf</span>
<span class="n">cluster_id</span> <span class="o">=</span> <span class="s2">&quot;SPT-CL J0000−5748&quot;</span>
<span class="n">cluster_m</span> <span class="o">=</span> <span class="mf">4.56e14</span>  <span class="c1"># M500,c</span>
<span class="n">cluster_z</span> <span class="o">=</span> <span class="mf">0.702</span>
<span class="n">cluster_ra</span> <span class="o">=</span> <span class="mf">0.2499</span>
<span class="n">cluster_dec</span> <span class="o">=</span> <span class="o">-</span><span class="mf">57.8064</span>
<span class="n">concentration</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># (arbitrary value, not from the paper)</span>

<span class="c1"># source redshift distribution properties</span>
<span class="n">cluster_beta_s_mean</span> <span class="o">=</span> <span class="mf">0.466</span>
<span class="n">cluster_beta_s2_mean</span> <span class="o">=</span> <span class="mf">0.243</span>
<span class="n">ngal_density</span> <span class="o">=</span> <span class="p">(</span>
    <span class="mf">26.0</span> <span class="o">*</span> <span class="mi">100</span>
<span class="p">)</span>  <span class="c1"># density of source galaxies per arcmin^2 # (arbitrary value, not from the paper)</span>
<span class="n">model_z_distrib_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;func&quot;</span><span class="p">:</span> <span class="n">desc_srd</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;desc_srd&quot;</span><span class="p">}</span>
<span class="n">delta_z_cut</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">zsrc_min</span> <span class="o">=</span> <span class="n">cluster_z</span> <span class="o">+</span> <span class="n">delta_z_cut</span>
<span class="n">zsrc_max</span> <span class="o">=</span> <span class="mf">3.0</span>
</pre></div>
</div>
</section>
<section id="defining-the-different-inputs-for-the-source-redshifts">
<h2>1 - Defining the different inputs for the source redshifts<a class="headerlink" href="#defining-the-different-inputs-for-the-source-redshifts" title="Link to this heading"></a></h2>
<section id="discrete-redshifts">
<h3>Discrete redshifts<a class="headerlink" href="#discrete-redshifts" title="Link to this heading"></a></h3>
<section id="generate-the-mock-source-catalog">
<h4>Generate the mock source catalog<a class="headerlink" href="#generate-the-mock-source-catalog" title="Link to this heading"></a></h4>
<p>The CLMM mock data generation will provide, among other things, a
redshift value for each background galaxy that is draw from the redshift
distribution given by <code class="docutils literal notranslate"><span class="pre">model_z_distrib_dict</span></code>.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">source_catalog</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">generate_galaxy_catalog</span><span class="p">(</span>
    <span class="n">cluster_m</span><span class="p">,</span>
    <span class="n">cluster_z</span><span class="p">,</span>
    <span class="n">concentration</span><span class="p">,</span>
    <span class="n">cosmo</span><span class="p">,</span>
    <span class="n">model_z_distrib_dict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
    <span class="n">delta_so</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">massdef</span><span class="o">=</span><span class="s2">&quot;critical&quot;</span><span class="p">,</span>
    <span class="n">zsrc_min</span><span class="o">=</span><span class="n">zsrc_min</span><span class="p">,</span>
    <span class="n">zsrc_max</span><span class="o">=</span><span class="n">zsrc_max</span><span class="p">,</span>
    <span class="n">ngal_density</span><span class="o">=</span><span class="n">ngal_density</span><span class="p">,</span>
    <span class="n">cluster_ra</span><span class="o">=</span><span class="n">cluster_ra</span><span class="p">,</span>
    <span class="n">cluster_dec</span><span class="o">=</span><span class="n">cluster_dec</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="beta-parameters">
<h3>Beta parameters<a class="headerlink" href="#beta-parameters" title="Link to this heading"></a></h3>
<p>From this udnerlying redshift distribution, one may directly compute the
average <span class="math notranslate nohighlight">\(\langle\beta_s\rangle\)</span> and
<span class="math notranslate nohighlight">\(\langle\beta_s^2\rangle\)</span> quantities</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">beta_label</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">beta</span><span class="p">:</span> <span class="sa">rf</span><span class="s2">&quot;\langle\beta_s\rangle = </span><span class="si">{</span><span class="n">beta</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="n">beta_sq_label</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">beta_sq</span><span class="p">:</span> <span class="sa">rf</span><span class="s2">&quot;\langle\beta_s^2\rangle = </span><span class="si">{</span><span class="n">beta_sq</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z_inf</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">beta_s_mean</span> <span class="o">=</span> <span class="n">clmm</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">compute_beta_s_mean</span><span class="p">(</span>
    <span class="n">cluster_z</span><span class="p">,</span>
    <span class="n">z_inf</span><span class="p">,</span>
    <span class="n">cosmo</span><span class="p">,</span>
    <span class="n">zmax</span><span class="o">=</span><span class="n">zsrc_max</span><span class="p">,</span>
    <span class="n">delta_z_cut</span><span class="o">=</span><span class="n">delta_z_cut</span><span class="p">,</span>
    <span class="n">zmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">z_distrib_func</span><span class="o">=</span><span class="n">model_z_distrib_dict</span><span class="p">[</span><span class="s2">&quot;func&quot;</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">beta_s_square_mean</span> <span class="o">=</span> <span class="n">clmm</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">compute_beta_s_square_mean</span><span class="p">(</span>
    <span class="n">cluster_z</span><span class="p">,</span>
    <span class="n">z_inf</span><span class="p">,</span>
    <span class="n">cosmo</span><span class="p">,</span>
    <span class="n">zmax</span><span class="o">=</span><span class="n">zsrc_max</span><span class="p">,</span>
    <span class="n">delta_z_cut</span><span class="o">=</span><span class="n">delta_z_cut</span><span class="p">,</span>
    <span class="n">zmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">z_distrib_func</span><span class="o">=</span><span class="n">model_z_distrib_dict</span><span class="p">[</span><span class="s2">&quot;func&quot;</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">Math</span><span class="p">(</span><span class="n">beta_label</span><span class="p">(</span><span class="n">beta_s_mean</span><span class="p">)))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Math</span><span class="p">(</span><span class="n">beta_sq_label</span><span class="p">(</span><span class="n">beta_s_square_mean</span><span class="p">)))</span>
</pre></div>
</div>
<div class="math notranslate nohighlight">
\[\displaystyle \langle\beta_s\rangle = 0.440\]</div>
<div class="math notranslate nohighlight">
\[\displaystyle \langle\beta_s^2\rangle = 0.220\]</div>
</section>
<section id="visualisation">
<h3>Visualisation<a class="headerlink" href="#visualisation" title="Link to this heading"></a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">zsrc_max</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">6</span><span class="p">)})</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">source_catalog</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;mock source redshift&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">zsrc_min</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;requested zmin&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;$</span><span class="si">{</span><span class="n">beta_label</span><span class="p">(</span><span class="n">beta_s_mean</span><span class="p">)</span><span class="si">}</span><span class="s2">$</span><span class="se">\n</span><span class="s2">$</span><span class="si">{</span><span class="n">beta_sq_label</span><span class="p">(</span><span class="n">beta_s_square_mean</span><span class="p">)</span><span class="si">}</span><span class="s2">$&quot;</span><span class="p">)</span>
<span class="c1"># here we multiply by a constant for visualisation purposes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">z</span><span class="p">,</span>
    <span class="n">model_z_distrib_dict</span><span class="p">[</span><span class="s2">&quot;func&quot;</span><span class="p">](</span><span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;redshift distribution fct (arbitrary normalisation)&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;$z_s$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;pdf&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">Legend</span> <span class="n">at</span> <span class="mh">0x7fc0c3d93350</span><span class="o">&gt;</span>
</pre></div>
</div>
<img alt="../_images/demo_theory_functionality_diff_z_types_21_1.png" src="../_images/demo_theory_functionality_diff_z_types_21_1.png" />
<p>Here we use a zmax=3 (different from default values) to highlight the
importance of specifying the zmax when computing the modeling.</p>
</section>
</section>
<section id="compute-models">
<h2>2 - Compute models<a class="headerlink" href="#compute-models" title="Link to this heading"></a></h2>
<p>Here we are computing the models for the tangential shear, reduced
shear, convergence, magnification and magnification bias.</p>
<section id="profile-from-mock-data">
<h3>Profile from mock data<a class="headerlink" href="#profile-from-mock-data" title="Link to this heading"></a></h3>
<p>First we compute the cluster profile based on the mock source catalog
produced in the previous section.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gc_object</span> <span class="o">=</span> <span class="n">clmm</span><span class="o">.</span><span class="n">GalaxyCluster</span><span class="p">(</span><span class="n">cluster_id</span><span class="p">,</span> <span class="n">cluster_ra</span><span class="p">,</span> <span class="n">cluster_dec</span><span class="p">,</span> <span class="n">cluster_z</span><span class="p">,</span> <span class="n">source_catalog</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gc_object</span><span class="o">.</span><span class="n">compute_tangential_and_cross_components</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">array</span><span class="p">([</span><span class="mf">0.00218744</span><span class="p">,</span> <span class="mf">0.00176588</span><span class="p">,</span> <span class="mf">0.00042673</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">0.00224765</span><span class="p">,</span> <span class="mf">0.00186142</span><span class="p">,</span>
        <span class="mf">0.00032859</span><span class="p">]),</span>
 <span class="n">array</span><span class="p">([</span><span class="mf">0.00898515</span><span class="p">,</span> <span class="mf">0.01455188</span><span class="p">,</span> <span class="mf">0.086497</span>  <span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">0.00915508</span><span class="p">,</span> <span class="mf">0.0164856</span> <span class="p">,</span>
        <span class="mf">0.13692621</span><span class="p">]),</span>
 <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">4.33680869e-18</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.80625564e-18</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.85722573e-17</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">5.20417043e-18</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.80625564e-18</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.93889390e-17</span><span class="p">]))</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gc_object</span><span class="o">.</span><span class="n">make_radial_profile</span><span class="p">(</span><span class="s2">&quot;Mpc&quot;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">cosmo</span><span class="o">=</span><span class="n">cosmo</span><span class="p">)</span>
<span class="k">pass</span>
</pre></div>
</div>
</section>
<section id="different-ways-of-modeling-the-reduced-shear">
<h3>Different ways of modeling the reduced shear<a class="headerlink" href="#different-ways-of-modeling-the-reduced-shear" title="Link to this heading"></a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define radius</span>
<span class="n">rr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<section id="case-1-discrete-redshift-and-exact-formula">
<h4><strong>Case 1 : Discrete redshift and exact formula</strong><a class="headerlink" href="#case-1-discrete-redshift-and-exact-formula" title="Link to this heading"></a></h4>
<p>In case we know the discrete source redshift, we can compute the reduced
shear for each source galaxy and take the average at a given radius.</p>
<p>This may take a bit of time, depending on the size of source redshift
catalog and number of radius points.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="c1"># in case we know the discrete source redshift, we can compute the reduced shear for each source galaxy</span>
<span class="c1"># and take the average at a given radius.</span>
<span class="n">gt_discrete</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
            <span class="n">clmm</span><span class="o">.</span><span class="n">theory</span><span class="o">.</span><span class="n">compute_reduced_tangential_shear</span><span class="p">(</span>
                <span class="n">_r</span><span class="p">,</span>
                <span class="n">cluster_m</span><span class="p">,</span>
                <span class="n">concentration</span><span class="p">,</span>
                <span class="n">cluster_z</span><span class="p">,</span>
                <span class="n">source_catalog</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">],</span>
                <span class="n">cosmo</span><span class="p">,</span>
                <span class="n">delta_mdef</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
                <span class="n">massdef</span><span class="o">=</span><span class="s2">&quot;critical&quot;</span><span class="p">,</span>
                <span class="n">z_src_info</span><span class="o">=</span><span class="s2">&quot;discrete&quot;</span><span class="p">,</span>
                <span class="n">approx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">_r</span> <span class="ow">in</span> <span class="n">rr</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">CPU</span> <span class="n">times</span><span class="p">:</span> <span class="n">user</span> <span class="mf">1.96</span> <span class="n">s</span><span class="p">,</span> <span class="n">sys</span><span class="p">:</span> <span class="mf">77.4</span> <span class="n">ms</span><span class="p">,</span> <span class="n">total</span><span class="p">:</span> <span class="mf">2.04</span> <span class="n">s</span>
<span class="n">Wall</span> <span class="n">time</span><span class="p">:</span> <span class="mf">2.04</span> <span class="n">s</span>
</pre></div>
</div>
</section>
<section id="case-2-redshift-distribution-and-exact-formula">
<h4>Case 2 : Redshift distribution and exact formula<a class="headerlink" href="#case-2-redshift-distribution-and-exact-formula" title="Link to this heading"></a></h4>
<p>If we don’t know the exact source redshift but we know the source mean
redshift distribution function, we can give it as input.</p>
<p>In this case, we are integrating over the distribution function so it
may be quite slow.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">gt_distribution_no_approx</span> <span class="o">=</span> <span class="n">clmm</span><span class="o">.</span><span class="n">theory</span><span class="o">.</span><span class="n">compute_reduced_tangential_shear</span><span class="p">(</span>
    <span class="n">rr</span><span class="p">,</span>
    <span class="n">cluster_m</span><span class="p">,</span>
    <span class="n">concentration</span><span class="p">,</span>
    <span class="n">cluster_z</span><span class="p">,</span>
    <span class="n">model_z_distrib_dict</span><span class="p">[</span><span class="s2">&quot;func&quot;</span><span class="p">],</span>
    <span class="n">cosmo</span><span class="p">,</span>
    <span class="n">delta_mdef</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">massdef</span><span class="o">=</span><span class="s2">&quot;critical&quot;</span><span class="p">,</span>
    <span class="n">z_src_info</span><span class="o">=</span><span class="s2">&quot;distribution&quot;</span><span class="p">,</span>
    <span class="n">beta_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;zmax&quot;</span><span class="p">:</span> <span class="n">zsrc_max</span><span class="p">},</span>
    <span class="n">approx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">CPU</span> <span class="n">times</span><span class="p">:</span> <span class="n">user</span> <span class="mi">136</span> <span class="n">ms</span><span class="p">,</span> <span class="n">sys</span><span class="p">:</span> <span class="mf">6.44</span> <span class="n">ms</span><span class="p">,</span> <span class="n">total</span><span class="p">:</span> <span class="mi">142</span> <span class="n">ms</span>
<span class="n">Wall</span> <span class="n">time</span><span class="p">:</span> <span class="mi">139</span> <span class="n">ms</span>
</pre></div>
</div>
</section>
<section id="cases-3-redshift-distribution-and-approximation">
<h4>Cases 3 : Redshift distribution and approximation<a class="headerlink" href="#cases-3-redshift-distribution-and-approximation" title="Link to this heading"></a></h4>
<p>If we want a faster approach we can use an approximation for the reduced
shear, using 1 or 2 order of Taylor expansion for the expression of the
reduced shear.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">gt_distribution_order1</span> <span class="o">=</span> <span class="n">clmm</span><span class="o">.</span><span class="n">theory</span><span class="o">.</span><span class="n">compute_reduced_tangential_shear</span><span class="p">(</span>
    <span class="n">rr</span><span class="p">,</span>
    <span class="n">cluster_m</span><span class="p">,</span>
    <span class="n">concentration</span><span class="p">,</span>
    <span class="n">cluster_z</span><span class="p">,</span>
    <span class="n">model_z_distrib_dict</span><span class="p">[</span><span class="s2">&quot;func&quot;</span><span class="p">],</span>
    <span class="n">cosmo</span><span class="p">,</span>
    <span class="n">delta_mdef</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">massdef</span><span class="o">=</span><span class="s2">&quot;critical&quot;</span><span class="p">,</span>
    <span class="n">z_src_info</span><span class="o">=</span><span class="s2">&quot;distribution&quot;</span><span class="p">,</span>
    <span class="n">beta_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;zmax&quot;</span><span class="p">:</span> <span class="n">zsrc_max</span><span class="p">},</span>
    <span class="n">approx</span><span class="o">=</span><span class="s2">&quot;order1&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">CPU</span> <span class="n">times</span><span class="p">:</span> <span class="n">user</span> <span class="mf">4.75</span> <span class="n">ms</span><span class="p">,</span> <span class="n">sys</span><span class="p">:</span> <span class="mi">0</span> <span class="n">ns</span><span class="p">,</span> <span class="n">total</span><span class="p">:</span> <span class="mf">4.75</span> <span class="n">ms</span>
<span class="n">Wall</span> <span class="n">time</span><span class="p">:</span> <span class="mf">4.59</span> <span class="n">ms</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">gt_distribution_order2</span> <span class="o">=</span> <span class="n">clmm</span><span class="o">.</span><span class="n">theory</span><span class="o">.</span><span class="n">compute_reduced_tangential_shear</span><span class="p">(</span>
    <span class="n">rr</span><span class="p">,</span>
    <span class="n">cluster_m</span><span class="p">,</span>
    <span class="n">concentration</span><span class="p">,</span>
    <span class="n">cluster_z</span><span class="p">,</span>
    <span class="n">model_z_distrib_dict</span><span class="p">[</span><span class="s2">&quot;func&quot;</span><span class="p">],</span>
    <span class="n">cosmo</span><span class="p">,</span>
    <span class="n">delta_mdef</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">massdef</span><span class="o">=</span><span class="s2">&quot;critical&quot;</span><span class="p">,</span>
    <span class="n">z_src_info</span><span class="o">=</span><span class="s2">&quot;distribution&quot;</span><span class="p">,</span>
    <span class="n">beta_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;zmax&quot;</span><span class="p">:</span> <span class="n">zsrc_max</span><span class="p">},</span>
    <span class="n">approx</span><span class="o">=</span><span class="s2">&quot;order2&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">CPU</span> <span class="n">times</span><span class="p">:</span> <span class="n">user</span> <span class="mf">7.75</span> <span class="n">ms</span><span class="p">,</span> <span class="n">sys</span><span class="p">:</span> <span class="mi">0</span> <span class="n">ns</span><span class="p">,</span> <span class="n">total</span><span class="p">:</span> <span class="mf">7.75</span> <span class="n">ms</span>
<span class="n">Wall</span> <span class="n">time</span><span class="p">:</span> <span class="mf">7.71</span> <span class="n">ms</span>
</pre></div>
</div>
</section>
<section id="cases-4-mean-lensing-efficiencies-and-approximation">
<h4>Cases 4 : Mean lensing efficiencies and approximation<a class="headerlink" href="#cases-4-mean-lensing-efficiencies-and-approximation" title="Link to this heading"></a></h4>
<div class="line-block">
<div class="line">Finally, we can also model the reduced shear if the only information
we have about the source redshift distribution is through the mean
lensing efficiency parameters <span class="math notranslate nohighlight">\(\langle\beta_s\rangle\)</span> and
<span class="math notranslate nohighlight">\(\langle\beta_s^2\rangle\)</span>.</div>
<div class="line">In this case, we need to use an approximation for the formula. This is
the fastest approach.</div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">gt_beta_1</span> <span class="o">=</span> <span class="n">clmm</span><span class="o">.</span><span class="n">theory</span><span class="o">.</span><span class="n">compute_reduced_tangential_shear</span><span class="p">(</span>
    <span class="n">rr</span><span class="p">,</span>
    <span class="n">cluster_m</span><span class="p">,</span>
    <span class="n">concentration</span><span class="p">,</span>
    <span class="n">cluster_z</span><span class="p">,</span>
    <span class="p">[</span><span class="n">beta_s_mean</span><span class="p">,</span> <span class="n">beta_s_square_mean</span><span class="p">],</span>
    <span class="n">cosmo</span><span class="p">,</span>
    <span class="n">delta_mdef</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">massdef</span><span class="o">=</span><span class="s2">&quot;critical&quot;</span><span class="p">,</span>
    <span class="n">z_src_info</span><span class="o">=</span><span class="s2">&quot;beta&quot;</span><span class="p">,</span>
    <span class="n">beta_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;zmax&quot;</span><span class="p">:</span> <span class="n">zsrc_max</span><span class="p">},</span>
    <span class="n">approx</span><span class="o">=</span><span class="s2">&quot;order1&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">CPU</span> <span class="n">times</span><span class="p">:</span> <span class="n">user</span> <span class="mf">1.18</span> <span class="n">ms</span><span class="p">,</span> <span class="n">sys</span><span class="p">:</span> <span class="mi">0</span> <span class="n">ns</span><span class="p">,</span> <span class="n">total</span><span class="p">:</span> <span class="mf">1.18</span> <span class="n">ms</span>
<span class="n">Wall</span> <span class="n">time</span><span class="p">:</span> <span class="mf">1.1</span> <span class="n">ms</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">gt_beta_2</span> <span class="o">=</span> <span class="n">clmm</span><span class="o">.</span><span class="n">theory</span><span class="o">.</span><span class="n">compute_reduced_tangential_shear</span><span class="p">(</span>
    <span class="n">rr</span><span class="p">,</span>
    <span class="n">cluster_m</span><span class="p">,</span>
    <span class="n">concentration</span><span class="p">,</span>
    <span class="n">cluster_z</span><span class="p">,</span>
    <span class="p">[</span><span class="n">beta_s_mean</span><span class="p">,</span> <span class="n">beta_s_square_mean</span><span class="p">],</span>
    <span class="n">cosmo</span><span class="p">,</span>
    <span class="n">delta_mdef</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">massdef</span><span class="o">=</span><span class="s2">&quot;critical&quot;</span><span class="p">,</span>
    <span class="n">z_src_info</span><span class="o">=</span><span class="s2">&quot;beta&quot;</span><span class="p">,</span>
    <span class="n">beta_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;zmax&quot;</span><span class="p">:</span> <span class="n">zsrc_max</span><span class="p">},</span>
    <span class="n">approx</span><span class="o">=</span><span class="s2">&quot;order2&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">CPU</span> <span class="n">times</span><span class="p">:</span> <span class="n">user</span> <span class="mf">1.08</span> <span class="n">ms</span><span class="p">,</span> <span class="n">sys</span><span class="p">:</span> <span class="mi">147</span> <span class="n">µs</span><span class="p">,</span> <span class="n">total</span><span class="p">:</span> <span class="mf">1.23</span> <span class="n">ms</span>
<span class="n">Wall</span> <span class="n">time</span><span class="p">:</span> <span class="mf">1.11</span> <span class="n">ms</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="comparison-of-the-four-cases-for-the-reduced-tangnetial-shear">
<h2>3 - Comparison of the four cases for the reduced tangnetial shear<a class="headerlink" href="#comparison-of-the-four-cases-for-the-reduced-tangnetial-shear" title="Link to this heading"></a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_cases</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">others</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)})</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="o">*</span><span class="n">base</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">base</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">case</span> <span class="ow">in</span> <span class="n">others</span><span class="p">:</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="o">*</span><span class="n">case</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">case</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">case</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">base</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="o">*</span><span class="n">case</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">case</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;radius [Mpc]&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;minor&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_cases</span><span class="p">(</span>
    <span class="n">rr</span><span class="p">,</span>
    <span class="n">base</span><span class="o">=</span><span class="p">(</span><span class="n">gt_discrete</span><span class="p">,</span> <span class="s2">&quot;k.-&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;discrete&quot;</span><span class="p">)),</span>
    <span class="n">others</span><span class="o">=</span><span class="p">(</span>
        <span class="p">(</span><span class="n">gt_distribution_no_approx</span><span class="p">,</span> <span class="s2">&quot;r.-&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;distribution, no approx&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">gt_distribution_order1</span><span class="p">,</span> <span class="s2">&quot;ro-&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;distribution, order 1 approx&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">gt_distribution_order2</span><span class="p">,</span> <span class="s2">&quot;rd-&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;distribution, order 2 approx&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">gt_beta_1</span><span class="p">,</span> <span class="s2">&quot;b--&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;beta, order 1 approx&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">gt_beta_2</span><span class="p">,</span> <span class="s2">&quot;bx-&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;beta, order 2 approx&quot;</span><span class="p">)),</span>
    <span class="p">),</span>
    <span class="n">data</span><span class="o">=</span><span class="p">(</span><span class="n">gc_object</span><span class="o">.</span><span class="n">profile</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">],</span> <span class="n">gc_object</span><span class="o">.</span><span class="n">profile</span><span class="p">[</span><span class="s2">&quot;gt&quot;</span><span class="p">],</span> <span class="s2">&quot;gs-&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)),</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;$g_t$&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/demo_theory_functionality_diff_z_types_48_0.png" src="../_images/demo_theory_functionality_diff_z_types_48_0.png" />
<p>All modeled profiles give similar results. They do not correspond to the
profile computed from the data in the inner part, because of different
ways of constructing the profiles (taking the average radial point and
reduced shear value in a bin or computing the average expected reduced
shear at a given radius).</p>
<p>The profiles computed using an approximation for the reduced shear
formula are lower by a few percents, especially in the inner region. The
profiles computed from a redshift distribution or a known source
redshift differ at the subpercent level.</p>
</section>
<section id="modeling-and-plotting-the-other-quantities">
<h2>4- Modeling and plotting the other quantities<a class="headerlink" href="#modeling-and-plotting-the-other-quantities" title="Link to this heading"></a></h2>
<p>Here we will just compute models for cases 1, 2 and 4. For the shear and
convergence there is no need for an approximated formula.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gammat_discrete</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
            <span class="n">clmm</span><span class="o">.</span><span class="n">theory</span><span class="o">.</span><span class="n">compute_tangential_shear</span><span class="p">(</span>
                <span class="n">_r</span><span class="p">,</span>
                <span class="n">cluster_m</span><span class="p">,</span>
                <span class="n">concentration</span><span class="p">,</span>
                <span class="n">cluster_z</span><span class="p">,</span>
                <span class="n">source_catalog</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">],</span>
                <span class="n">cosmo</span><span class="p">,</span>
                <span class="n">delta_mdef</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
                <span class="n">massdef</span><span class="o">=</span><span class="s2">&quot;critical&quot;</span><span class="p">,</span>
                <span class="n">z_src_info</span><span class="o">=</span><span class="s2">&quot;discrete&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">_r</span> <span class="ow">in</span> <span class="n">rr</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">gammat_distribution</span> <span class="o">=</span> <span class="n">clmm</span><span class="o">.</span><span class="n">theory</span><span class="o">.</span><span class="n">compute_tangential_shear</span><span class="p">(</span>
    <span class="n">rr</span><span class="p">,</span>
    <span class="n">cluster_m</span><span class="p">,</span>
    <span class="n">concentration</span><span class="p">,</span>
    <span class="n">cluster_z</span><span class="p">,</span>
    <span class="n">model_z_distrib_dict</span><span class="p">[</span><span class="s2">&quot;func&quot;</span><span class="p">],</span>
    <span class="n">cosmo</span><span class="p">,</span>
    <span class="n">delta_mdef</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">massdef</span><span class="o">=</span><span class="s2">&quot;critical&quot;</span><span class="p">,</span>
    <span class="n">z_src_info</span><span class="o">=</span><span class="s2">&quot;distribution&quot;</span><span class="p">,</span>
    <span class="n">beta_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;zmax&quot;</span><span class="p">:</span> <span class="n">zsrc_max</span><span class="p">},</span>
<span class="p">)</span>

<span class="n">gammat_beta</span> <span class="o">=</span> <span class="n">clmm</span><span class="o">.</span><span class="n">theory</span><span class="o">.</span><span class="n">compute_tangential_shear</span><span class="p">(</span>
    <span class="n">rr</span><span class="p">,</span>
    <span class="n">cluster_m</span><span class="p">,</span>
    <span class="n">concentration</span><span class="p">,</span>
    <span class="n">cluster_z</span><span class="p">,</span>
    <span class="p">[</span><span class="n">beta_s_mean</span><span class="p">,</span> <span class="n">beta_s_square_mean</span><span class="p">],</span>
    <span class="n">cosmo</span><span class="p">,</span>
    <span class="n">delta_mdef</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">massdef</span><span class="o">=</span><span class="s2">&quot;critical&quot;</span><span class="p">,</span>
    <span class="n">z_src_info</span><span class="o">=</span><span class="s2">&quot;beta&quot;</span><span class="p">,</span>
    <span class="n">beta_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;zmax&quot;</span><span class="p">:</span> <span class="n">zsrc_max</span><span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_cases</span><span class="p">(</span>
    <span class="n">rr</span><span class="p">,</span>
    <span class="n">base</span><span class="o">=</span><span class="p">(</span><span class="n">gammat_discrete</span><span class="p">,</span> <span class="s2">&quot;k.-&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;discrete&quot;</span><span class="p">)),</span>
    <span class="n">others</span><span class="o">=</span><span class="p">(</span>
        <span class="p">(</span><span class="n">gammat_distribution</span><span class="p">,</span> <span class="s2">&quot;rx-&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;distribution, no approx&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">gammat_beta</span><span class="p">,</span> <span class="s2">&quot;b--&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;beta, no approx&quot;</span><span class="p">)),</span>
    <span class="p">),</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;$\gamma_t$&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/demo_theory_functionality_diff_z_types_53_0.png" src="../_images/demo_theory_functionality_diff_z_types_53_0.png" />
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kappa_discrete</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
            <span class="n">clmm</span><span class="o">.</span><span class="n">theory</span><span class="o">.</span><span class="n">compute_convergence</span><span class="p">(</span>
                <span class="n">_r</span><span class="p">,</span>
                <span class="n">cluster_m</span><span class="p">,</span>
                <span class="n">concentration</span><span class="p">,</span>
                <span class="n">cluster_z</span><span class="p">,</span>
                <span class="n">source_catalog</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">],</span>
                <span class="n">cosmo</span><span class="p">,</span>
                <span class="n">delta_mdef</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
                <span class="n">massdef</span><span class="o">=</span><span class="s2">&quot;critical&quot;</span><span class="p">,</span>
                <span class="n">z_src_info</span><span class="o">=</span><span class="s2">&quot;discrete&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">_r</span> <span class="ow">in</span> <span class="n">rr</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">kappa_distribution</span> <span class="o">=</span> <span class="n">clmm</span><span class="o">.</span><span class="n">theory</span><span class="o">.</span><span class="n">compute_convergence</span><span class="p">(</span>
    <span class="n">rr</span><span class="p">,</span>
    <span class="n">cluster_m</span><span class="p">,</span>
    <span class="n">concentration</span><span class="p">,</span>
    <span class="n">cluster_z</span><span class="p">,</span>
    <span class="n">model_z_distrib_dict</span><span class="p">[</span><span class="s2">&quot;func&quot;</span><span class="p">],</span>
    <span class="n">cosmo</span><span class="p">,</span>
    <span class="n">delta_mdef</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">massdef</span><span class="o">=</span><span class="s2">&quot;critical&quot;</span><span class="p">,</span>
    <span class="n">z_src_info</span><span class="o">=</span><span class="s2">&quot;distribution&quot;</span><span class="p">,</span>
    <span class="n">beta_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;zmax&quot;</span><span class="p">:</span> <span class="n">zsrc_max</span><span class="p">},</span>
<span class="p">)</span>

<span class="n">kappa_beta</span> <span class="o">=</span> <span class="n">clmm</span><span class="o">.</span><span class="n">theory</span><span class="o">.</span><span class="n">compute_convergence</span><span class="p">(</span>
    <span class="n">rr</span><span class="p">,</span>
    <span class="n">cluster_m</span><span class="p">,</span>
    <span class="n">concentration</span><span class="p">,</span>
    <span class="n">cluster_z</span><span class="p">,</span>
    <span class="p">[</span><span class="n">beta_s_mean</span><span class="p">,</span> <span class="n">beta_s_square_mean</span><span class="p">],</span>
    <span class="n">cosmo</span><span class="p">,</span>
    <span class="n">delta_mdef</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">massdef</span><span class="o">=</span><span class="s2">&quot;critical&quot;</span><span class="p">,</span>
    <span class="n">z_src_info</span><span class="o">=</span><span class="s2">&quot;beta&quot;</span><span class="p">,</span>
    <span class="n">beta_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;zmax&quot;</span><span class="p">:</span> <span class="n">zsrc_max</span><span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_cases</span><span class="p">(</span>
    <span class="n">rr</span><span class="p">,</span>
    <span class="n">base</span><span class="o">=</span><span class="p">(</span><span class="n">kappa_discrete</span><span class="p">,</span> <span class="s2">&quot;k.-&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;discrete&quot;</span><span class="p">)),</span>
    <span class="n">others</span><span class="o">=</span><span class="p">(</span>
        <span class="p">(</span><span class="n">kappa_distribution</span><span class="p">,</span> <span class="s2">&quot;rx-&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;distribution, no approx&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">kappa_beta</span><span class="p">,</span> <span class="s2">&quot;b--&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;beta, no approx&quot;</span><span class="p">)),</span>
    <span class="p">),</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;$\kappa_t$&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/demo_theory_functionality_diff_z_types_55_0.png" src="../_images/demo_theory_functionality_diff_z_types_55_0.png" />
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mu_discrete</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
            <span class="n">clmm</span><span class="o">.</span><span class="n">theory</span><span class="o">.</span><span class="n">compute_magnification</span><span class="p">(</span>
                <span class="n">_r</span><span class="p">,</span>
                <span class="n">cluster_m</span><span class="p">,</span>
                <span class="n">concentration</span><span class="p">,</span>
                <span class="n">cluster_z</span><span class="p">,</span>
                <span class="n">source_catalog</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">],</span>
                <span class="n">cosmo</span><span class="p">,</span>
                <span class="n">delta_mdef</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
                <span class="n">massdef</span><span class="o">=</span><span class="s2">&quot;critical&quot;</span><span class="p">,</span>
                <span class="n">z_src_info</span><span class="o">=</span><span class="s2">&quot;discrete&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">_r</span> <span class="ow">in</span> <span class="n">rr</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">mu_distribution</span> <span class="o">=</span> <span class="n">clmm</span><span class="o">.</span><span class="n">theory</span><span class="o">.</span><span class="n">compute_magnification</span><span class="p">(</span>
    <span class="n">rr</span><span class="p">,</span>
    <span class="n">cluster_m</span><span class="p">,</span>
    <span class="n">concentration</span><span class="p">,</span>
    <span class="n">cluster_z</span><span class="p">,</span>
    <span class="n">model_z_distrib_dict</span><span class="p">[</span><span class="s2">&quot;func&quot;</span><span class="p">],</span>
    <span class="n">cosmo</span><span class="p">,</span>
    <span class="n">delta_mdef</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">massdef</span><span class="o">=</span><span class="s2">&quot;critical&quot;</span><span class="p">,</span>
    <span class="n">z_src_info</span><span class="o">=</span><span class="s2">&quot;distribution&quot;</span><span class="p">,</span>
    <span class="n">approx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">beta_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;zmax&quot;</span><span class="p">:</span> <span class="n">zsrc_max</span><span class="p">},</span>
<span class="p">)</span>

<span class="n">mu_beta_1</span> <span class="o">=</span> <span class="n">clmm</span><span class="o">.</span><span class="n">theory</span><span class="o">.</span><span class="n">compute_magnification</span><span class="p">(</span>
    <span class="n">rr</span><span class="p">,</span>
    <span class="n">cluster_m</span><span class="p">,</span>
    <span class="n">concentration</span><span class="p">,</span>
    <span class="n">cluster_z</span><span class="p">,</span>
    <span class="p">[</span><span class="n">beta_s_mean</span><span class="p">,</span> <span class="n">beta_s_square_mean</span><span class="p">],</span>
    <span class="n">cosmo</span><span class="p">,</span>
    <span class="n">delta_mdef</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">massdef</span><span class="o">=</span><span class="s2">&quot;critical&quot;</span><span class="p">,</span>
    <span class="n">z_src_info</span><span class="o">=</span><span class="s2">&quot;beta&quot;</span><span class="p">,</span>
    <span class="n">approx</span><span class="o">=</span><span class="s2">&quot;order1&quot;</span><span class="p">,</span>
    <span class="n">beta_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;zmax&quot;</span><span class="p">:</span> <span class="n">zsrc_max</span><span class="p">},</span>
<span class="p">)</span>

<span class="n">mu_beta_2</span> <span class="o">=</span> <span class="n">clmm</span><span class="o">.</span><span class="n">theory</span><span class="o">.</span><span class="n">compute_magnification</span><span class="p">(</span>
    <span class="n">rr</span><span class="p">,</span>
    <span class="n">cluster_m</span><span class="p">,</span>
    <span class="n">concentration</span><span class="p">,</span>
    <span class="n">cluster_z</span><span class="p">,</span>
    <span class="p">[</span><span class="n">beta_s_mean</span><span class="p">,</span> <span class="n">beta_s_square_mean</span><span class="p">],</span>
    <span class="n">cosmo</span><span class="p">,</span>
    <span class="n">delta_mdef</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">massdef</span><span class="o">=</span><span class="s2">&quot;critical&quot;</span><span class="p">,</span>
    <span class="n">z_src_info</span><span class="o">=</span><span class="s2">&quot;beta&quot;</span><span class="p">,</span>
    <span class="n">approx</span><span class="o">=</span><span class="s2">&quot;order2&quot;</span><span class="p">,</span>
    <span class="n">beta_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;zmax&quot;</span><span class="p">:</span> <span class="n">zsrc_max</span><span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_cases</span><span class="p">(</span>
    <span class="n">rr</span><span class="p">,</span>
    <span class="n">base</span><span class="o">=</span><span class="p">(</span><span class="n">mu_discrete</span><span class="p">,</span> <span class="s2">&quot;k.-&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;discrete&quot;</span><span class="p">)),</span>
    <span class="n">others</span><span class="o">=</span><span class="p">(</span>
        <span class="p">(</span><span class="n">mu_distribution</span><span class="p">,</span> <span class="s2">&quot;rs-&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;distribution, no approx&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">mu_beta_1</span><span class="p">,</span> <span class="s2">&quot;bx-&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;beta, order 1 approx&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">mu_beta_2</span><span class="p">,</span> <span class="s2">&quot;b--&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;beta, order 2 approx&quot;</span><span class="p">)),</span>
    <span class="p">),</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;$\mu_t$&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/demo_theory_functionality_diff_z_types_57_0.png" src="../_images/demo_theory_functionality_diff_z_types_57_0.png" />
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">2.7</span>  <span class="c1"># arbitrary value for the slope of the number density</span>

<span class="n">mu_bias_discrete</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
            <span class="n">clmm</span><span class="o">.</span><span class="n">theory</span><span class="o">.</span><span class="n">compute_magnification_bias</span><span class="p">(</span>
                <span class="n">_r</span><span class="p">,</span>
                <span class="n">alpha</span><span class="p">,</span>
                <span class="n">cluster_m</span><span class="p">,</span>
                <span class="n">concentration</span><span class="p">,</span>
                <span class="n">cluster_z</span><span class="p">,</span>
                <span class="n">source_catalog</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">],</span>
                <span class="n">cosmo</span><span class="p">,</span>
                <span class="n">delta_mdef</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
                <span class="n">massdef</span><span class="o">=</span><span class="s2">&quot;critical&quot;</span><span class="p">,</span>
                <span class="n">z_src_info</span><span class="o">=</span><span class="s2">&quot;discrete&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">_r</span> <span class="ow">in</span> <span class="n">rr</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">mu_bias_distribution</span> <span class="o">=</span> <span class="n">clmm</span><span class="o">.</span><span class="n">theory</span><span class="o">.</span><span class="n">compute_magnification_bias</span><span class="p">(</span>
    <span class="n">rr</span><span class="p">,</span>
    <span class="n">alpha</span><span class="p">,</span>
    <span class="n">cluster_m</span><span class="p">,</span>
    <span class="n">concentration</span><span class="p">,</span>
    <span class="n">cluster_z</span><span class="p">,</span>
    <span class="n">model_z_distrib_dict</span><span class="p">[</span><span class="s2">&quot;func&quot;</span><span class="p">],</span>
    <span class="n">cosmo</span><span class="p">,</span>
    <span class="n">delta_mdef</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">massdef</span><span class="o">=</span><span class="s2">&quot;critical&quot;</span><span class="p">,</span>
    <span class="n">z_src_info</span><span class="o">=</span><span class="s2">&quot;distribution&quot;</span><span class="p">,</span>
    <span class="n">approx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">beta_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;zmax&quot;</span><span class="p">:</span> <span class="n">zsrc_max</span><span class="p">},</span>
<span class="p">)</span>

<span class="n">mu_bias_beta_1</span> <span class="o">=</span> <span class="n">clmm</span><span class="o">.</span><span class="n">theory</span><span class="o">.</span><span class="n">compute_magnification_bias</span><span class="p">(</span>
    <span class="n">rr</span><span class="p">,</span>
    <span class="n">alpha</span><span class="p">,</span>
    <span class="n">cluster_m</span><span class="p">,</span>
    <span class="n">concentration</span><span class="p">,</span>
    <span class="n">cluster_z</span><span class="p">,</span>
    <span class="p">[</span><span class="n">beta_s_mean</span><span class="p">,</span> <span class="n">beta_s_square_mean</span><span class="p">],</span>
    <span class="n">cosmo</span><span class="p">,</span>
    <span class="n">delta_mdef</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">massdef</span><span class="o">=</span><span class="s2">&quot;critical&quot;</span><span class="p">,</span>
    <span class="n">z_src_info</span><span class="o">=</span><span class="s2">&quot;beta&quot;</span><span class="p">,</span>
    <span class="n">approx</span><span class="o">=</span><span class="s2">&quot;order1&quot;</span><span class="p">,</span>
    <span class="n">beta_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;zmax&quot;</span><span class="p">:</span> <span class="n">zsrc_max</span><span class="p">},</span>
<span class="p">)</span>

<span class="n">mu_bias_beta_2</span> <span class="o">=</span> <span class="n">clmm</span><span class="o">.</span><span class="n">theory</span><span class="o">.</span><span class="n">compute_magnification_bias</span><span class="p">(</span>
    <span class="n">rr</span><span class="p">,</span>
    <span class="n">alpha</span><span class="p">,</span>
    <span class="n">cluster_m</span><span class="p">,</span>
    <span class="n">concentration</span><span class="p">,</span>
    <span class="n">cluster_z</span><span class="p">,</span>
    <span class="p">[</span><span class="n">beta_s_mean</span><span class="p">,</span> <span class="n">beta_s_square_mean</span><span class="p">],</span>
    <span class="n">cosmo</span><span class="p">,</span>
    <span class="n">delta_mdef</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">massdef</span><span class="o">=</span><span class="s2">&quot;critical&quot;</span><span class="p">,</span>
    <span class="n">z_src_info</span><span class="o">=</span><span class="s2">&quot;beta&quot;</span><span class="p">,</span>
    <span class="n">approx</span><span class="o">=</span><span class="s2">&quot;order2&quot;</span><span class="p">,</span>
    <span class="n">beta_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;zmax&quot;</span><span class="p">:</span> <span class="n">zsrc_max</span><span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_cases</span><span class="p">(</span>
    <span class="n">rr</span><span class="p">,</span>
    <span class="n">base</span><span class="o">=</span><span class="p">(</span><span class="n">mu_bias_discrete</span><span class="p">,</span> <span class="s2">&quot;k.-&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;discrete&quot;</span><span class="p">)),</span>
    <span class="n">others</span><span class="o">=</span><span class="p">(</span>
        <span class="p">(</span><span class="n">mu_bias_distribution</span><span class="p">,</span> <span class="s2">&quot;rs-&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;distribution, no approx&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">mu_bias_beta_1</span><span class="p">,</span> <span class="s2">&quot;bx-&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;beta, order 1 approx&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">mu_bias_beta_2</span><span class="p">,</span> <span class="s2">&quot;b--&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;beta, order 2 approx&quot;</span><span class="p">)),</span>
    <span class="p">),</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;$\delta_{\mu} + 1$&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/demo_theory_functionality_diff_z_types_59_0.png" src="../_images/demo_theory_functionality_diff_z_types_59_0.png" />
<p>When making approximation, there may be large differences (~few 10%
level) in the inner regions (compare to when using the exact redshift of
the sources), especially for magnification and magnification bias.
However, these approaches are very fast to compute. The user as to chose
the appropriate method depending on the use case.</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2021, LSST DESC CLMM Contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>