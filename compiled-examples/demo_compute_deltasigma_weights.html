<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Weak lensing weights &mdash; CLMM 1.12.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=fe8e256b"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Mass conversion between different mass definitions" href="demo_mass_conversion.html" />
    <link rel="prev" title="Boost factors" href="demo_boost_factors.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            CLMM
          </a>
              <div class="version">
                1.12.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../source/overview.html">Rapid overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source/citing.html">Using and citing CLMM</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Usage Demos</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="demo_mock_cluster.html">Generate mock data for a cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="demo_dataops_functionality.html">Measure WL Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="demo_theory_functionality.html">Model WL Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="demo_mock_ensemble.html">Generate mock data for a cluster ensemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_and_model_demo_DC2.html">Using the cosmoDC2 catalog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Mass Fitting Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Example1_Fit_Halo_Mass_to_Shear_Catalog.html">Example 1: Ideal data</a></li>
<li class="toctree-l1"><a class="reference internal" href="Example1_Fit_shear_profile_with_miscentering.html">Example 1b: Impact of miscentering</a></li>
<li class="toctree-l1"><a class="reference internal" href="Example2_Fit_Halo_Mass_to_Shear_Catalog.html">Example 2: Realistic data and wrong model</a></li>
<li class="toctree-l1"><a class="reference internal" href="Example3_Fit_Halo_Mass_to_Shear_Catalog.html">Example 3: Account for the n(z) of sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="Example4_Fit_Halo_mass_to_HSC_data.html">Example 4: Using a real dataset (HSC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Example5_Fit_Halo_mass_to_DES_data.html">Example 5: Using a real datasets (DES)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="demo_theory_functionality_diff_z_types.html">Model WL Profiles (different redshift inputs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="demo_theory_functionality_oo.html">Model WL Profiles (Object Oriented)</a></li>
<li class="toctree-l1"><a class="reference internal" href="demo_boost_factors.html">Boost factors</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Weak lensing weights</a></li>
<li class="toctree-l1"><a class="reference internal" href="demo_mass_conversion.html">Mass conversion between different mass definitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="demo_mock_ensemble_realistic.html">Generate “realistic” mock data for a cluster ensemble</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/clmm.clusterensemble.html">clmm.clusterensemble module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/clmm.constants.html">clmm.constants module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/clmm.cosmology.html">clmm.cosmology package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.cosmology.ccl.html">clmm.cosmology.ccl module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.cosmology.cluster_toolkit.html">clmm.cosmology.cluster_toolkit module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.cosmology.numcosmo.html">clmm.cosmology.numcosmo module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.cosmology.parent_class.html">clmm.cosmology.parent_class module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/clmm.dataops.html">clmm.dataops package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/clmm.galaxycluster.html">clmm.galaxycluster module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/clmm.gcdata.html">clmm.gcdata module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/clmm.redshift.html">clmm.redshift package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.redshift.distributions.html">clmm.redshift.distributions module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.redshift.tools.html">clmm.redshift.tools module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/clmm.theory.html">clmm.theory package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.theory.ccl.html">clmm.theory.ccl module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.theory.cluster_toolkit.html">clmm.theory.cluster_toolkit module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.theory.func_layer.html">clmm.theory.func_layer module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.theory.generic.html">clmm.theory.generic module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.theory.numcosmo.html">clmm.theory.numcosmo module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.theory.parent_class.html">clmm.theory.parent_class module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/clmm.plotting.html">clmm.plotting package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/clmm.utils.html">clmm.utils package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.utils.beta_lens.html">clmm.utils.beta_lens module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.utils.boost.html">clmm.utils.boost module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.utils.ellipticity.html">clmm.utils.ellipticity module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.utils.statistic.html">clmm.utils.statistic module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.utils.units.html">clmm.utils.units module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.utils.validation.html">clmm.utils.validation module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/clmm.support.html">clmm.support package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.support.mock_data.html">clmm.support.mock_data module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/clmm.support.sampler.html">clmm.support.sampler module</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CLMM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Weak lensing weights</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/compiled-examples/demo_compute_deltasigma_weights.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="weak-lensing-weights">
<h1>Weak lensing weights<a class="headerlink" href="#weak-lensing-weights" title="Link to this heading"></a></h1>
<section id="weak-lensing-weights-to-compute-the-delta-sigma-profile">
<h2>Weak lensing weights to compute the <span class="math notranslate nohighlight">\(\Delta\Sigma\)</span> profile<a class="headerlink" href="#weak-lensing-weights-to-compute-the-delta-sigma-profile" title="Link to this heading"></a></h2>
<p>The excess surface mass density profile computed from the data is
computed from a weighted average</p>
<div class="math notranslate nohighlight">
\[\widehat{\Delta\Sigma}_+(R) = \frac{1}{\sum\limits_{l,s = 1} w_{l,s}}
\sum\limits_{l,s= 1}w_{l,s}\widehat{\Sigma_{{\rm crit}}}(z_s, z_l)\epsilon_+^{l,s}.\]</div>
<p>where the sum runs over all lens-background source pairs,
<span class="math notranslate nohighlight">\(\epsilon_+^{l,s}\)</span> is the tangential ellipticity,
<span class="math notranslate nohighlight">\(\Sigma_{\rm crit}(z_s, z_l)\)</span> is the critical surface density, and
where the weights</p>
<div class="math notranslate nohighlight">
\[w_{l,s} = \frac{\left(\int_{z_l}^{+\infty}\Sigma_{\rm crit}(z_l, z)^{-1}p(z) dz\right)^2}{\sigma^2_{\rm shapenoise} + \sigma^2_{\rm shape\ error}}.\]</div>
<p>Where <span class="math notranslate nohighlight">\(p(z)\)</span> is the photometric redshift ditribution. These
weights correspond to the maximum likelihood estimator of
<span class="math notranslate nohighlight">\(\Delta\Sigma\)</span> (e.g., Shirasaki &amp; Takada 2018).</p>
<p>Identifying background galaxies can be made by considering the
individual probability to be in the background of the cluster i.e.</p>
<div class="math notranslate nohighlight">
\[P(z &gt; z_l) = \int_{z_l}^{+\infty} dz\ p(z)\]</div>
<p>to be higher than a given threshold.</p>
<p>In this notebook, we show the <code class="docutils literal notranslate"><span class="pre">clmm</span></code> functionalities developed to
compute: - those weights under a variety of configuration (true
redhsifts or photoz, shape noise or not, ideal galaxy shapes or not). -
the background probability <span class="math notranslate nohighlight">\(P(z &gt; z_l)\)</span> for each galaxy</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">import</span> <span class="nn">copy</span>

<span class="kn">import</span> <span class="nn">clmm</span>
<span class="kn">from</span> <span class="nn">clmm</span> <span class="kn">import</span> <span class="n">Cosmology</span>
<span class="kn">from</span> <span class="nn">clmm</span> <span class="kn">import</span> <span class="n">GalaxyCluster</span>
<span class="kn">from</span> <span class="nn">clmm.dataops</span> <span class="kn">import</span> <span class="n">compute_galaxy_weights</span><span class="p">,</span> <span class="n">compute_background_probability</span>
<span class="kn">from</span> <span class="nn">clmm.support</span> <span class="kn">import</span> <span class="n">mock_data</span> <span class="k">as</span> <span class="n">mock</span>
<span class="kn">from</span> <span class="nn">clmm.theory</span> <span class="kn">import</span> <span class="n">compute_critical_surface_density_eff</span>

<span class="n">clmm</span><span class="o">.</span><span class="n">__version__</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;1.12.0&#39;</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cosmo</span> <span class="o">=</span> <span class="n">Cosmology</span><span class="p">(</span><span class="n">H0</span><span class="o">=</span><span class="mf">71.0</span><span class="p">,</span> <span class="n">Omega_dm0</span><span class="o">=</span><span class="mf">0.265</span> <span class="o">-</span> <span class="mf">0.0448</span><span class="p">,</span> <span class="n">Omega_b0</span><span class="o">=</span><span class="mf">0.0448</span><span class="p">,</span> <span class="n">Omega_k0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cluster_z</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="n">cluster_m</span> <span class="o">=</span> <span class="mf">1.0e14</span>
<span class="n">cluster_c</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">cluster_ra</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">cluster_dec</span> <span class="o">=</span> <span class="mf">0.0</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">noisy_data_z</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">generate_galaxy_catalog</span><span class="p">(</span>
    <span class="n">cluster_m</span><span class="p">,</span>
    <span class="n">cluster_z</span><span class="p">,</span>
    <span class="n">cluster_c</span><span class="p">,</span>
    <span class="n">cosmo</span><span class="p">,</span>
    <span class="n">cluster_ra</span><span class="o">=</span><span class="n">cluster_ra</span><span class="p">,</span>
    <span class="n">cluster_dec</span><span class="o">=</span><span class="n">cluster_dec</span><span class="p">,</span>
    <span class="n">delta_so</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">massdef</span><span class="o">=</span><span class="s2">&quot;critical&quot;</span><span class="p">,</span>
    <span class="n">halo_profile_model</span><span class="o">=</span><span class="s2">&quot;nfw&quot;</span><span class="p">,</span>
    <span class="n">zsrc</span><span class="o">=</span><span class="s2">&quot;chang13&quot;</span><span class="p">,</span>
    <span class="n">zsrc_min</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span>
    <span class="n">zsrc_max</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
    <span class="n">photoz_sigma_unscaled</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
    <span class="n">shapenoise</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
    <span class="n">mean_e_err</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">field_size</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
    <span class="n">ngals</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">z_gal</span> <span class="o">=</span> <span class="n">noisy_data_z</span><span class="p">[</span><span class="s2">&quot;ztrue&quot;</span><span class="p">]</span>
<span class="c1"># add redshift dependency on shape measurement error</span>
<span class="n">noisy_data_z</span><span class="p">[</span><span class="s2">&quot;e_err&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">noisy_data_z</span><span class="p">[</span><span class="s2">&quot;e_err&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="n">noisy_data_z</span><span class="p">[</span><span class="s2">&quot;ztrue&quot;</span><span class="p">])</span>
<span class="n">cluster</span> <span class="o">=</span> <span class="n">GalaxyCluster</span><span class="p">(</span><span class="s2">&quot;mock_cluster&quot;</span><span class="p">,</span> <span class="n">cluster_ra</span><span class="p">,</span> <span class="n">cluster_dec</span><span class="p">,</span> <span class="n">cluster_z</span><span class="p">,</span> <span class="n">noisy_data_z</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="k">global</span><span class="o">/</span><span class="n">homes</span><span class="o">/</span><span class="n">a</span><span class="o">/</span><span class="n">aguena</span><span class="o">/.</span><span class="n">local</span><span class="o">/</span><span class="n">perlmutter</span><span class="o">/</span><span class="n">python</span><span class="o">-</span><span class="mf">3.11</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">clmm</span><span class="o">-</span><span class="mf">1.12.0</span><span class="o">-</span><span class="n">py3</span><span class="mf">.11</span><span class="o">.</span><span class="n">egg</span><span class="o">/</span><span class="n">clmm</span><span class="o">/</span><span class="n">theory</span><span class="o">/</span><span class="n">parent_class</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">768</span><span class="p">:</span> <span class="ne">UserWarning</span><span class="p">:</span>
<span class="n">Some</span> <span class="n">source</span> <span class="n">redshifts</span> <span class="n">are</span> <span class="n">lower</span> <span class="n">than</span> <span class="n">the</span> <span class="n">cluster</span> <span class="n">redshift</span><span class="o">.</span>
<span class="n">Shear</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">those</span> <span class="n">galaxies</span><span class="o">.</span>
<span class="o">/</span><span class="k">global</span><span class="o">/</span><span class="n">homes</span><span class="o">/</span><span class="n">a</span><span class="o">/</span><span class="n">aguena</span><span class="o">/.</span><span class="n">local</span><span class="o">/</span><span class="n">perlmutter</span><span class="o">/</span><span class="n">python</span><span class="o">-</span><span class="mf">3.11</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">clmm</span><span class="o">-</span><span class="mf">1.12.0</span><span class="o">-</span><span class="n">py3</span><span class="mf">.11</span><span class="o">.</span><span class="n">egg</span><span class="o">/</span><span class="n">clmm</span><span class="o">/</span><span class="n">theory</span><span class="o">/</span><span class="n">parent_class</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">852</span><span class="p">:</span> <span class="ne">UserWarning</span><span class="p">:</span>
<span class="n">Some</span> <span class="n">source</span> <span class="n">redshifts</span> <span class="n">are</span> <span class="n">lower</span> <span class="n">than</span> <span class="n">the</span> <span class="n">cluster</span> <span class="n">redshift</span><span class="o">.</span>
<span class="n">Convergence</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">those</span> <span class="n">galaxies</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="compute-the-wl-weights">
<h2>Compute the WL weights<a class="headerlink" href="#compute-the-wl-weights" title="Link to this heading"></a></h2>
<section id="redshift-point-estimate-no-shape-error">
<h3>redshift point estimate + no shape error<a class="headerlink" href="#redshift-point-estimate-no-shape-error" title="Link to this heading"></a></h3>
<div class="math notranslate nohighlight">
\[w_{\rm ls} = \Sigma_{\rm crit}(z_l, z_s)^{-2}\]</div>
<section id="using-the-functional-interface">
<h4>Using the functional interface<a class="headerlink" href="#using-the-functional-interface" title="Link to this heading"></a></h4>
<p>First, we need to compute <span class="math notranslate nohighlight">\(\Sigma_{\rm crit}\)</span>. Here, we use the
true source redshifts stored in <code class="docutils literal notranslate"><span class="pre">z_gal</span></code></p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sigma_c</span> <span class="o">=</span> <span class="n">cosmo</span><span class="o">.</span><span class="n">eval_sigma_crit</span><span class="p">(</span><span class="n">cluster_z</span><span class="p">,</span> <span class="n">z_gal</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="k">global</span><span class="o">/</span><span class="n">homes</span><span class="o">/</span><span class="n">a</span><span class="o">/</span><span class="n">aguena</span><span class="o">/.</span><span class="n">local</span><span class="o">/</span><span class="n">perlmutter</span><span class="o">/</span><span class="n">python</span><span class="o">-</span><span class="mf">3.11</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">clmm</span><span class="o">-</span><span class="mf">1.12.0</span><span class="o">-</span><span class="n">py3</span><span class="mf">.11</span><span class="o">.</span><span class="n">egg</span><span class="o">/</span><span class="n">clmm</span><span class="o">/</span><span class="n">cosmology</span><span class="o">/</span><span class="n">parent_class</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">110</span><span class="p">:</span> <span class="ne">UserWarning</span><span class="p">:</span>
<span class="n">Some</span> <span class="n">source</span> <span class="n">redshifts</span> <span class="n">are</span> <span class="n">lower</span> <span class="n">than</span> <span class="n">the</span> <span class="n">cluster</span> <span class="n">redshift</span><span class="o">.</span>
<span class="n">Sigma_crit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="k">for</span> <span class="n">those</span> <span class="n">galaxies</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w_ls_true</span> <span class="o">=</span> <span class="n">compute_galaxy_weights</span><span class="p">(</span>
    <span class="n">sigma_c</span><span class="o">=</span><span class="n">sigma_c</span><span class="p">,</span>
    <span class="n">is_deltasigma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">use_shape_noise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="as-a-method-of-the-galaxycluster-object">
<h4>As a method of the <code class="docutils literal notranslate"><span class="pre">GalaxyCluster</span></code> object<a class="headerlink" href="#as-a-method-of-the-galaxycluster-object" title="Link to this heading"></a></h4>
<p>As a method of the <code class="docutils literal notranslate"><span class="pre">GalaxyCluster</span></code> object, <code class="docutils literal notranslate"><span class="pre">compute_galaxy_weights</span></code>
uses the content of the <code class="docutils literal notranslate"><span class="pre">z</span></code> column of the object’s <code class="docutils literal notranslate"><span class="pre">galcat</span></code> table as
the source redshift point estimates. Given that mock data was generated
with a photoz error, this point estimate is different from the true
redshift used in the cell above.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w_ls_point</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">compute_galaxy_weights</span><span class="p">(</span>
    <span class="n">use_pdz</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">weight_name</span><span class="o">=</span><span class="s2">&quot;w_ls_point&quot;</span><span class="p">,</span> <span class="n">cosmo</span><span class="o">=</span><span class="n">cosmo</span><span class="p">,</span> <span class="n">is_deltasigma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="k">global</span><span class="o">/</span><span class="n">homes</span><span class="o">/</span><span class="n">a</span><span class="o">/</span><span class="n">aguena</span><span class="o">/.</span><span class="n">local</span><span class="o">/</span><span class="n">perlmutter</span><span class="o">/</span><span class="n">python</span><span class="o">-</span><span class="mf">3.11</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">clmm</span><span class="o">-</span><span class="mf">1.12.0</span><span class="o">-</span><span class="n">py3</span><span class="mf">.11</span><span class="o">.</span><span class="n">egg</span><span class="o">/</span><span class="n">clmm</span><span class="o">/</span><span class="n">cosmology</span><span class="o">/</span><span class="n">parent_class</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">110</span><span class="p">:</span> <span class="ne">UserWarning</span><span class="p">:</span>
<span class="n">Some</span> <span class="n">source</span> <span class="n">redshifts</span> <span class="n">are</span> <span class="n">lower</span> <span class="n">than</span> <span class="n">the</span> <span class="n">cluster</span> <span class="n">redshift</span><span class="o">.</span>
<span class="n">Sigma_crit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="k">for</span> <span class="n">those</span> <span class="n">galaxies</span><span class="o">.</span>
</pre></div>
</div>
</section>
</section>
<section id="photoz-no-shape-errors">
<h3>photoz + no shape errors<a class="headerlink" href="#photoz-no-shape-errors" title="Link to this heading"></a></h3>
<p>When considering the photo-z distribution, we can compute the weight
based on an effective critical surface density:</p>
<div class="math notranslate nohighlight">
\[w_{\rm ls} = \Sigma_{\rm crit}^{\rm eff}(z_l)^{-2},\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\Sigma_{\rm crit}^{\rm eff}(z_l) = \left(\int_{z_l}^{+\infty}\Sigma_{\rm crit}(z_l, z)^{-1}p(z) dz\right)^{-1}.\]</div>
<section id="id1">
<h4>Using the functional interface<a class="headerlink" href="#id1" title="Link to this heading"></a></h4>
<p>First, we need to compute <span class="math notranslate nohighlight">\(\Sigma_{\rm crit}^{\rm eff}\)</span>. Here, we
use the true source redshifts stored in <code class="docutils literal notranslate"><span class="pre">z_gal</span></code></p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sigma_c_eff</span> <span class="o">=</span> <span class="n">compute_critical_surface_density_eff</span><span class="p">(</span>
    <span class="n">cosmo</span><span class="o">=</span><span class="n">cosmo</span><span class="p">,</span>
    <span class="n">z_cluster</span><span class="o">=</span><span class="n">cluster_z</span><span class="p">,</span>
    <span class="n">pzbins</span><span class="o">=</span><span class="n">noisy_data_z</span><span class="o">.</span><span class="n">pzpdf_info</span><span class="p">[</span><span class="s2">&quot;zbins&quot;</span><span class="p">],</span>
    <span class="n">pzpdf</span><span class="o">=</span><span class="n">noisy_data_z</span><span class="p">[</span><span class="s2">&quot;pzpdf&quot;</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="k">global</span><span class="o">/</span><span class="n">homes</span><span class="o">/</span><span class="n">a</span><span class="o">/</span><span class="n">aguena</span><span class="o">/.</span><span class="n">local</span><span class="o">/</span><span class="n">perlmutter</span><span class="o">/</span><span class="n">python</span><span class="o">-</span><span class="mf">3.11</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">clmm</span><span class="o">-</span><span class="mf">1.12.0</span><span class="o">-</span><span class="n">py3</span><span class="mf">.11</span><span class="o">.</span><span class="n">egg</span><span class="o">/</span><span class="n">clmm</span><span class="o">/</span><span class="n">cosmology</span><span class="o">/</span><span class="n">parent_class</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">110</span><span class="p">:</span> <span class="ne">UserWarning</span><span class="p">:</span>
<span class="n">Some</span> <span class="n">source</span> <span class="n">redshifts</span> <span class="n">are</span> <span class="n">lower</span> <span class="n">than</span> <span class="n">the</span> <span class="n">cluster</span> <span class="n">redshift</span><span class="o">.</span>
<span class="n">Sigma_crit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="k">for</span> <span class="n">those</span> <span class="n">galaxies</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w_ls_photoz</span> <span class="o">=</span> <span class="n">compute_galaxy_weights</span><span class="p">(</span>
    <span class="n">sigma_c</span><span class="o">=</span><span class="n">sigma_c_eff</span><span class="p">,</span>
    <span class="n">is_deltasigma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">use_shape_noise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id2">
<h4>As a method of the <code class="docutils literal notranslate"><span class="pre">GalaxyCluster</span></code> object<a class="headerlink" href="#id2" title="Link to this heading"></a></h4>
<p>When used as a method of the <code class="docutils literal notranslate"><span class="pre">GalaxyCluster</span></code> object, with
<code class="docutils literal notranslate"><span class="pre">use_pdz=True</span></code>, <code class="docutils literal notranslate"><span class="pre">compute_galaxy_weights</span></code> uses the content of the
<code class="docutils literal notranslate"><span class="pre">pzpdf</span></code> and <code class="docutils literal notranslate"><span class="pre">pzbins</span></code> columns of the <code class="docutils literal notranslate"><span class="pre">galcat</span></code> table. It will return
an error if those do not exist.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w_ls_photoz</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">compute_galaxy_weights</span><span class="p">(</span>
    <span class="n">use_pdz</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">weight_name</span><span class="o">=</span><span class="s2">&quot;w_ls_photoz&quot;</span><span class="p">,</span> <span class="n">cosmo</span><span class="o">=</span><span class="n">cosmo</span><span class="p">,</span> <span class="n">is_deltasigma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="k">global</span><span class="o">/</span><span class="n">homes</span><span class="o">/</span><span class="n">a</span><span class="o">/</span><span class="n">aguena</span><span class="o">/.</span><span class="n">local</span><span class="o">/</span><span class="n">perlmutter</span><span class="o">/</span><span class="n">python</span><span class="o">-</span><span class="mf">3.11</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">clmm</span><span class="o">-</span><span class="mf">1.12.0</span><span class="o">-</span><span class="n">py3</span><span class="mf">.11</span><span class="o">.</span><span class="n">egg</span><span class="o">/</span><span class="n">clmm</span><span class="o">/</span><span class="n">cosmology</span><span class="o">/</span><span class="n">parent_class</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">110</span><span class="p">:</span> <span class="ne">UserWarning</span><span class="p">:</span>
<span class="n">Some</span> <span class="n">source</span> <span class="n">redshifts</span> <span class="n">are</span> <span class="n">lower</span> <span class="n">than</span> <span class="n">the</span> <span class="n">cluster</span> <span class="n">redshift</span><span class="o">.</span>
<span class="n">Sigma_crit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="k">for</span> <span class="n">those</span> <span class="n">galaxies</span><span class="o">.</span>
</pre></div>
</div>
</section>
</section>
<section id="redshift-point-estimate-shape-error">
<h3>redshift point estimate + shape error<a class="headerlink" href="#redshift-point-estimate-shape-error" title="Link to this heading"></a></h3>
<div class="math notranslate nohighlight">
\[w_{\rm ls} = \frac{\Sigma_{\rm crit}(z_l, z_s)^{-2}}{\sigma_{\rm shapenoise}^2 + \sigma^2_{\rm shape\ error}}\]</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w_ls_shape</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">compute_galaxy_weights</span><span class="p">(</span>
    <span class="n">use_pdz</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">use_shape_noise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">shape_component1</span><span class="o">=</span><span class="s2">&quot;e1&quot;</span><span class="p">,</span>
    <span class="n">shape_component2</span><span class="o">=</span><span class="s2">&quot;e2&quot;</span><span class="p">,</span>
    <span class="n">use_shape_error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">shape_component1_err</span><span class="o">=</span><span class="s2">&quot;e_err&quot;</span><span class="p">,</span>
    <span class="n">shape_component2_err</span><span class="o">=</span><span class="s2">&quot;e_err&quot;</span><span class="p">,</span>
    <span class="n">weight_name</span><span class="o">=</span><span class="s2">&quot;w_ls_shape&quot;</span><span class="p">,</span>
    <span class="n">cosmo</span><span class="o">=</span><span class="n">cosmo</span><span class="p">,</span>
    <span class="n">is_deltasigma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">add</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="photoz-shape-error">
<h3>photoz + shape error<a class="headerlink" href="#photoz-shape-error" title="Link to this heading"></a></h3>
<div class="math notranslate nohighlight">
\[w_{\rm ls} = \frac{\Sigma_{\rm crit}^{\rm eff}(z_l, z)^{-2}}{\sigma_{\rm shapenoise}^2 + \sigma^2_{\rm shape\ error}}\]</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w_ls_photoz_shape</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">compute_galaxy_weights</span><span class="p">(</span>
    <span class="n">use_pdz</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">use_shape_noise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">shape_component1</span><span class="o">=</span><span class="s2">&quot;e1&quot;</span><span class="p">,</span>
    <span class="n">shape_component2</span><span class="o">=</span><span class="s2">&quot;e2&quot;</span><span class="p">,</span>
    <span class="n">use_shape_error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">shape_component1_err</span><span class="o">=</span><span class="s2">&quot;e_err&quot;</span><span class="p">,</span>
    <span class="n">shape_component2_err</span><span class="o">=</span><span class="s2">&quot;e_err&quot;</span><span class="p">,</span>
    <span class="n">weight_name</span><span class="o">=</span><span class="s2">&quot;w_ls_photoz_shape&quot;</span><span class="p">,</span>
    <span class="n">cosmo</span><span class="o">=</span><span class="n">cosmo</span><span class="p">,</span>
    <span class="n">is_deltasigma</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">add</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>With <code class="docutils literal notranslate"><span class="pre">add=True</span></code>, the weights have been added as new columns in the
<code class="docutils literal notranslate"><span class="pre">cl.galcat</span></code> Table. A new <code class="docutils literal notranslate"><span class="pre">sigma_c</span></code> column is also automatically
added.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cluster</span><span class="o">.</span><span class="n">galcat</span><span class="o">.</span><span class="n">colnames</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">,</span>
 <span class="s1">&#39;dec&#39;</span><span class="p">,</span>
 <span class="s1">&#39;e1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;e2&#39;</span><span class="p">,</span>
 <span class="s1">&#39;e_err&#39;</span><span class="p">,</span>
 <span class="s1">&#39;z&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ztrue&#39;</span><span class="p">,</span>
 <span class="s1">&#39;pzpdf&#39;</span><span class="p">,</span>
 <span class="s1">&#39;id&#39;</span><span class="p">,</span>
 <span class="s1">&#39;sigma_c&#39;</span><span class="p">,</span>
 <span class="s1">&#39;w_ls_point&#39;</span><span class="p">,</span>
 <span class="s1">&#39;sigma_c_eff&#39;</span><span class="p">,</span>
 <span class="s1">&#39;w_ls_photoz&#39;</span><span class="p">,</span>
 <span class="s1">&#39;w_ls_shape&#39;</span><span class="p">,</span>
 <span class="s1">&#39;w_ls_photoz_shape&#39;</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="sigma-rm-crit-metadata">
<h3><span class="math notranslate nohighlight">\(\Sigma_{\rm crit}\)</span> metadata<a class="headerlink" href="#sigma-rm-crit-metadata" title="Link to this heading"></a></h3>
<p>As seen above, the weights are computed either using the standard
definition of <span class="math notranslate nohighlight">\(\Sigma_{\rm crit}^{\rm std}\)</span>, using point estimate
redshift, or the effective definition based on the inverse
<span class="math notranslate nohighlight">\(\Sigma_c^{\rm eff}\)</span> averaged over the redshift PDF <span class="math notranslate nohighlight">\(p(z)\)</span>:</p>
<div class="math notranslate nohighlight">
\[\Sigma_{\rm crit}^{\rm std}\equiv\Sigma_{\rm crit}(z_l, z_s) \;\;{\rm and}\;\; \Sigma_{\rm crit}^{\rm eff}\equiv\left( \int \Sigma_{\rm crit}(z_l, z)^{-1} p(z) dz\right)^{-1}\]</div>
<p>To keep track of what definition of <span class="math notranslate nohighlight">\(\Sigma_{\rm crit}\)</span> was used,
<code class="docutils literal notranslate"><span class="pre">standard</span></code> or <code class="docutils literal notranslate"><span class="pre">effective</span></code> the user may look into the <code class="docutils literal notranslate"><span class="pre">galcat</span></code>
metadata</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;For cluster w_ls_point column        :&quot;</span><span class="p">,</span>
    <span class="n">cluster</span><span class="o">.</span><span class="n">galcat</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;w_ls_point_sigmac_type&quot;</span><span class="p">],</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;For cluster w_ls_photoz column       :&quot;</span><span class="p">,</span>
    <span class="n">cluster</span><span class="o">.</span><span class="n">galcat</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;w_ls_photoz_sigmac_type&quot;</span><span class="p">],</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;For cluster w_ls_shape column        :&quot;</span><span class="p">,</span>
    <span class="n">cluster</span><span class="o">.</span><span class="n">galcat</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;w_ls_shape_sigmac_type&quot;</span><span class="p">],</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;For cluster w_ls_photoz_shape column :&quot;</span><span class="p">,</span>
    <span class="n">cluster</span><span class="o">.</span><span class="n">galcat</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;w_ls_photoz_shape_sigmac_type&quot;</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">For</span> <span class="n">cluster</span> <span class="n">w_ls_point</span> <span class="n">column</span>        <span class="p">:</span> <span class="n">standard</span>
<span class="n">For</span> <span class="n">cluster</span> <span class="n">w_ls_photoz</span> <span class="n">column</span>       <span class="p">:</span> <span class="n">effective</span>
<span class="n">For</span> <span class="n">cluster</span> <span class="n">w_ls_shape</span> <span class="n">column</span>        <span class="p">:</span> <span class="n">standard</span>
<span class="n">For</span> <span class="n">cluster</span> <span class="n">w_ls_photoz_shape</span> <span class="n">column</span> <span class="p">:</span> <span class="n">effective</span>
</pre></div>
</div>
</section>
<section id="vizualizing-the-results">
<h3>Vizualizing the results<a class="headerlink" href="#vizualizing-the-results" title="Link to this heading"></a></h3>
<p>The figure below shows the normalized weight per galaxy
<span class="math notranslate nohighlight">\(\widehat{w}_{ls} = \frac{w_{ls}}{\sum _{s = 1}^N w_{ls}}\)</span>.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;axes.linewidth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">cluster_z</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">cluster_z</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">z_gal</span><span class="p">,</span>
    <span class="mf">1e3</span> <span class="o">*</span> <span class="n">cluster</span><span class="o">.</span><span class="n">galcat</span><span class="p">[</span><span class="s2">&quot;w_ls_point&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">cluster</span><span class="o">.</span><span class="n">galcat</span><span class="p">[</span><span class="s2">&quot;w_ls_point&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
    <span class="n">c</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;point estimate z&quot;</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">z_gal</span><span class="p">,</span>
    <span class="mf">1e3</span> <span class="o">*</span> <span class="n">cluster</span><span class="o">.</span><span class="n">galcat</span><span class="p">[</span><span class="s2">&quot;w_ls_photoz&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">cluster</span><span class="o">.</span><span class="n">galcat</span><span class="p">[</span><span class="s2">&quot;w_ls_photoz&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
    <span class="n">c</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;photoz pdf&quot;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">z_gal</span><span class="p">,</span> <span class="mf">1e3</span> <span class="o">*</span> <span class="n">w_ls_true</span> <span class="o">/</span> <span class="n">w_ls_true</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;true z&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">z_gal</span><span class="p">,</span>
    <span class="mf">1e3</span> <span class="o">*</span> <span class="n">cluster</span><span class="o">.</span><span class="n">galcat</span><span class="p">[</span><span class="s2">&quot;w_ls_shape&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">cluster</span><span class="o">.</span><span class="n">galcat</span><span class="p">[</span><span class="s2">&quot;w_ls_shape&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
    <span class="n">c</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;shape_error, point z&quot;</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">z_gal</span><span class="p">,</span>
    <span class="mf">1e3</span> <span class="o">*</span> <span class="n">cluster</span><span class="o">.</span><span class="n">galcat</span><span class="p">[</span><span class="s2">&quot;w_ls_photoz_shape&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">cluster</span><span class="o">.</span><span class="n">galcat</span><span class="p">[</span><span class="s2">&quot;w_ls_photoz_shape&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
    <span class="n">c</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;shape_error + photoz pdf&quot;</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\widehat</span><span class="si">{w}</span><span class="s2">_</span><span class="si">{ls}</span><span class="s2"> (\times 10^{-3})$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;true redshift&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;true redshift&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">Text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;true redshift&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/demo_compute_deltasigma_weights_31_1.png" src="../_images/demo_compute_deltasigma_weights_31_1.png" />
<ul class="simple">
<li><p>The galaxy weights increase with the true galaxy redshift (left
panel, red dots), i.e. weights take account that galaxies far from
the cluster are more sheared than closer ones.</p></li>
<li><p>Using true redshift (left panel, green dots), weights for foreground
galaxies are 0.</p></li>
<li><p>Adding photoz, either point estimate or including p(z) (left panel,
red and orange dots):</p>
<ul>
<li><p>weights are scattered around the true redshift weigthts (when
photoz’s are not biased)</p></li>
<li><p>some foreground galaxies (with true redshift &lt;
<span class="math notranslate nohighlight">\(z_{\rm cluster}\)</span>) have non-zero weights</p></li>
<li><p>here the point estimate and p(z) results are very close because
<code class="docutils literal notranslate"><span class="pre">mock_data</span></code> generates photoz a gaussian p(z) with the point
estimate at the mean. Reality will be more complex and the orange
and red points may differ more.</p></li>
</ul>
</li>
<li><p>Adding shape error with redshift dependency
<span class="math notranslate nohighlight">\(\sigma(z) = \sigma_0(1 + \alpha z)\)</span> (right panel, blus dots),
high redshift galaxies with measured shapes have smaller weights than
considering true shapes (comparing to left panel, red dots).</p></li>
<li><p>when combining photoz + shape error, both effects can be seen on
galaxy weights (right panel, cyan dots).</p></li>
</ul>
</section>
<section id="background-probability">
<h3>Background probability<a class="headerlink" href="#background-probability" title="Link to this heading"></a></h3>
<p>The probability for a galaxy with photometric redshift of being in the
background of the cluster is given by</p>
<div class="math notranslate nohighlight">
\[P(z &gt; z_l) = \int_{z_l}^{+\infty} dz\ p(z)\]</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate new GC object with smaller photoz dispersion for comparison with cl0.</span>
<span class="n">noisy_data_z_2</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">generate_galaxy_catalog</span><span class="p">(</span>
    <span class="mf">1e14</span><span class="p">,</span>
    <span class="n">cluster_z</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">,</span>
    <span class="n">cosmo</span><span class="p">,</span>
    <span class="n">delta_so</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">massdef</span><span class="o">=</span><span class="s2">&quot;critical&quot;</span><span class="p">,</span>
    <span class="n">halo_profile_model</span><span class="o">=</span><span class="s2">&quot;nfw&quot;</span><span class="p">,</span>
    <span class="n">zsrc</span><span class="o">=</span><span class="s2">&quot;chang13&quot;</span><span class="p">,</span>
    <span class="n">zsrc_min</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">zsrc_max</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
    <span class="n">photoz_sigma_unscaled</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span>
    <span class="n">shapenoise</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
    <span class="n">mean_e_err</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">field_size</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
    <span class="n">ngals</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">cluster_new</span> <span class="o">=</span> <span class="n">clmm</span><span class="o">.</span><span class="n">GalaxyCluster</span><span class="p">(</span><span class="s2">&quot;mock_cluster&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cluster_z</span><span class="p">,</span> <span class="n">noisy_data_z_2</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="k">global</span><span class="o">/</span><span class="n">homes</span><span class="o">/</span><span class="n">a</span><span class="o">/</span><span class="n">aguena</span><span class="o">/.</span><span class="n">local</span><span class="o">/</span><span class="n">perlmutter</span><span class="o">/</span><span class="n">python</span><span class="o">-</span><span class="mf">3.11</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">clmm</span><span class="o">-</span><span class="mf">1.12.0</span><span class="o">-</span><span class="n">py3</span><span class="mf">.11</span><span class="o">.</span><span class="n">egg</span><span class="o">/</span><span class="n">clmm</span><span class="o">/</span><span class="n">theory</span><span class="o">/</span><span class="n">parent_class</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">768</span><span class="p">:</span> <span class="ne">UserWarning</span><span class="p">:</span>
<span class="n">Some</span> <span class="n">source</span> <span class="n">redshifts</span> <span class="n">are</span> <span class="n">lower</span> <span class="n">than</span> <span class="n">the</span> <span class="n">cluster</span> <span class="n">redshift</span><span class="o">.</span>
<span class="n">Shear</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">those</span> <span class="n">galaxies</span><span class="o">.</span>
<span class="o">/</span><span class="k">global</span><span class="o">/</span><span class="n">homes</span><span class="o">/</span><span class="n">a</span><span class="o">/</span><span class="n">aguena</span><span class="o">/.</span><span class="n">local</span><span class="o">/</span><span class="n">perlmutter</span><span class="o">/</span><span class="n">python</span><span class="o">-</span><span class="mf">3.11</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">clmm</span><span class="o">-</span><span class="mf">1.12.0</span><span class="o">-</span><span class="n">py3</span><span class="mf">.11</span><span class="o">.</span><span class="n">egg</span><span class="o">/</span><span class="n">clmm</span><span class="o">/</span><span class="n">theory</span><span class="o">/</span><span class="n">parent_class</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">852</span><span class="p">:</span> <span class="ne">UserWarning</span><span class="p">:</span>
<span class="n">Some</span> <span class="n">source</span> <span class="n">redshifts</span> <span class="n">are</span> <span class="n">lower</span> <span class="n">than</span> <span class="n">the</span> <span class="n">cluster</span> <span class="n">redshift</span><span class="o">.</span>
<span class="n">Convergence</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">those</span> <span class="n">galaxies</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p_background_true</span> <span class="o">=</span> <span class="n">compute_background_probability</span><span class="p">(</span><span class="n">cluster_z</span><span class="p">,</span> <span class="n">z_gal</span><span class="p">)</span>  <span class="c1"># based on cl0 generation</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p_background_photoz_1</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">compute_background_probability</span><span class="p">(</span>
    <span class="n">use_pdz</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">p_background_name</span><span class="o">=</span><span class="s2">&quot;p_background_photoz_1&quot;</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p_background_photoz_2</span> <span class="o">=</span> <span class="n">cluster_new</span><span class="o">.</span><span class="n">compute_background_probability</span><span class="p">(</span>
    <span class="n">use_pdz</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">p_background_name</span><span class="o">=</span><span class="s2">&quot;p_background_photoz_2&quot;</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plt.rcParams[&#39;axes.linewidth&#39;] = 1</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">cluster_new</span><span class="o">.</span><span class="n">galcat</span><span class="p">[</span><span class="s2">&quot;ztrue&quot;</span><span class="p">],</span>
    <span class="n">p_background_photoz_2</span><span class="p">,</span>
    <span class="n">c</span><span class="o">=</span><span class="s2">&quot;darkorange&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\sigma_z = 0.02$&quot;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">cluster</span><span class="o">.</span><span class="n">galcat</span><span class="p">[</span><span class="s2">&quot;ztrue&quot;</span><span class="p">],</span>
    <span class="n">p_background_photoz_1</span><span class="p">,</span>
    <span class="n">c</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\sigma_z = 0.05$&quot;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">z_gal</span><span class="p">,</span> <span class="n">p_background_true</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">110</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;True z&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">cluster_z</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;true source redshift&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$P(z_s &gt; z_l)$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>


<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.155</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">])</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">cluster_new</span><span class="o">.</span><span class="n">galcat</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">],</span>
    <span class="n">p_background_photoz_2</span><span class="p">,</span>
    <span class="n">c</span><span class="o">=</span><span class="s2">&quot;darkorange&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\sigma_z = 0.02$&quot;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">lw</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">cluster</span><span class="o">.</span><span class="n">galcat</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">],</span>
    <span class="n">p_background_photoz_1</span><span class="p">,</span>
    <span class="n">c</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\sigma_z = 0.05$&quot;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">lw</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">(</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
    <span class="o">*</span><span class="n">ax2</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span>
    <span class="o">*</span><span class="n">ax2</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span>
<span class="p">):</span>
    <span class="n">item</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">cluster_z</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">])</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;obs. source redshift&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">Text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;obs. source redshift&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/demo_compute_deltasigma_weights_39_1.png" src="../_images/demo_compute_deltasigma_weights_39_1.png" />
<p>The figure above shows the background probability <span class="math notranslate nohighlight">\(P(z &gt; z_l)\)</span> for
each galaxy. - When using true redshift (green), the background
probability is a Heavyside function centered on <span class="math notranslate nohighlight">\(z_s\)</span>,
i.e. <span class="math notranslate nohighlight">\(p(z) = \delta^D(z-z_s)\)</span>. - When using photometric redshift
(blue and orange dots), galaxies on the foreground of the cluster have
non-zero probability to be in the background. Idem, for close galaxies
in the background, the probability in being in the foreground is
non-zero. - These weights represent the fraction of the galaxy PDF that
is located behind the cluster and is mapped to the observed redshift as
it can be seen on the top left panel. The scatter in the main panel
comes from the scatter between true and observed redshifts.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2021, LSST DESC CLMM Contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>