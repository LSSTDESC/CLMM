# Get new changes

git fetch origin
git merge origin/main
python setup.py install --user > /dev/null

# Make the documentation

    # get kwargs
NO_DC2=false
NO_HSC=false
NO_DES=false
for ARGUMENT in "$@"
do
    if [ "${ARGUMENT::1}" = "-" ]
    then
        if [ "$ARGUMENT" = "--no-dc2" ]
            then
            NO_DC2=true
        elif [ "$ARGUMENT" = "--no-hsc" ]
            then
            NO_HSC=true
        elif [ "$ARGUMENT" = "--no-des" ]
            then
            NO_DES=true
        elif [ "$ARGUMENT" = "--no-data" ]
            then
            NO_DC2=true
            NO_HSC=true
            NO_DES=true
        else
            echo "ERROR! Unknown '$ARGUMENT' argument"
            exit
        fi
    fi
done
    # funcs to turn on/off args in conf
function turn_on(){
sed -i -e 's/'"$1"' = False/'"$1"' = True/g'  conf.py
}
function turn_off(){
sed -i -e 's/'"$1"' = True/'"$1"' = False/g'  conf.py
}
function comment(){
sed -i -e '/'"$1"'/s/^/#/' conf.py
}
function uncomment(){
sed -i -e '/'"$1"'/s/^#//' conf.py
}

cd docs/
make clean
turn_on 'run_nb'
if [ $NO_DC2 = true ];then uncomment '_DC2'; fi
if [ $NO_HSC = true ];then uncomment '_HSC'; fi
if [ $NO_DES = true ];then uncomment '_DES'; fi
make html
turn_off 'run_nb'
if [ $NO_DC2 = true ];then comment '_DC2'; fi
if [ $NO_HSC = true ];then comment '_HSC'; fi
if [ $NO_DES = true ];then comment '_DES'; fi
cd ..

# Add and commit changes

MASTERCOMMIT="$(git log --pretty=format:'%h' -n 1 main)"

git add docs/_build/
git status
git commit -m "Added main commit $MASTERCOMMIT to docs"
git push

# Push changes to branch used by the website

git subtree push --prefix docs/_build/html/ origin gh-pages
